<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making Deep Learning Models with immApex • scRepertoire</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Making Deep Learning Models with immApex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scRepertoire</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Getting Started</a>
</li>
<li>
  <a href="../articles/Installation.html">Install</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Loading.html">Loading Data</a>
    </li>
    <li>
      <a href="../articles/Combining_Contigs.html">Combining Contigs into Clones</a>
    </li>
    <li>
      <a href="../articles/Processing.html">Additional Processing</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/Clonal_Visualizations.html">Basic Clonal Analysis</a>
    </li>
    <li>
      <a href="../articles/Clonal_Dynamics.html">Visualizing Clonal Dynamics</a>
    </li>
    <li>
      <a href="../articles/Repertoire_Summary.html">Summarizing Repertoires</a>
    </li>
    <li>
      <a href="../articles/Clonal_Diversity.html">Clonal Diversity, Rarefaction, and Overlap</a>
    </li>
    <li>
      <a href="../articles/Clonal_Cluster.html">Clustering Sequences by Edit Distance</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/Attaching_SC.html">Combining Clones and Single-Cell Objects</a>
    </li>
    <li>
      <a href="../articles/SC_Visualizations.html">Visualizations for Single-Cell Objects</a>
    </li>
    <li>
      <a href="../articles/Clonal_Bias.html">Quantifying Clonal Bias</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/immApex.html">Making Deep Learning Models with immApex</a>
    </li>
    <li>
      <a href="../articles/Trex.html">Combining Deep Learning and TCRs with Trex</a>
    </li>
    <li>
      <a href="../articles/Ibex.html">Combining Deep Learning and BCRs with Ibex</a>
    </li>
    <li>
      <a href="../articles/Running_Escape.html">Single-cell Gene Set Enrichment Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News/Changelog</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/FAQ.html">FAQ</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BorchLab/scRepertoire/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Making Deep Learning Models with immApex</h1>
            
            <h4 data-toc-skip class="date">Compiled: March 19, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BorchLab/scRepertoire/blob/HEAD/vignettes/articles/immApex.Rmd" class="external-link"><code>vignettes/articles/immApex.Rmd</code></a></small>
      <div class="hidden name"><code>immApex.Rmd</code></div>

    </div>

    
    
<style>
p.caption {
  font-size: 0.9em;
}
</style>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p><strong>immApex</strong> is meant to serve as an API for
deep-learning models based on immune receptor sequencing. These
functions extract or generate amino acid or nucleotide sequences and
prepare them for deep learning tasks through <a href="https://tensorflow.rstudio.com/guides/keras/basics" class="external-link">Keras</a>.
<strong>immApex</strong> is the underlying structure for the BCR models
in <a href="https://github.com/BorchLab/Ibex" class="external-link">Ibex</a> and TCR models in
<a href="https://github.com/BorchLab/Trex" class="external-link">Trex</a>. It should be noted
that the tools here are created for immune receptor sequences; they will
work more generally for nucleotide or amino acid sequences. The package
itself supports AIRR, Adaptive, and 10x formats and interacts with the
<strong>scRepertoire</strong> R package.</p>
<p>More information is available at the <a href="https://github.com/BorchLab/immApex" class="external-link">immApex GitHub Repo</a>.</p>
<div class="section level3">
<h3 id="loading-libraries">Loading Libraries<a class="anchor" aria-label="anchor" href="#loading-libraries"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncborcherding/immApex/" class="external-link">immApex</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/" class="external-link">keras</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-and-manipulating-sequences">Getting and Manipulating Sequences<a class="anchor" aria-label="anchor" href="#getting-and-manipulating-sequences"></a>
</h2>
<div class="section level3">
<h3 id="generatesequences">generateSequences<a class="anchor" aria-label="anchor" href="#generatesequences"></a>
</h3>
<p>Generating synthetic sequences is a quick way to start testing the
model code. <code><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences()</a></code> can also generate realistic
noise for generative adversarial networks.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences()</a></code></p>
<ul>
<li>
<strong>prefix.motif</strong> Add a defined sequence to the start of
the generated sequences.</li>
<li>
<strong>suffix.motif</strong> Add a defined sequence to the end of
the generated sequences number.of.sequences Number of sequences to
generate</li>
<li>
<strong>min.length</strong> Minimum length of the final sequence
(will be adjusted if incongruent with prefix.motif/suffix.motif)</li>
<li>
<strong>max.length</strong> Maximum length of the final
sequence</li>
<li>
<strong>sequence.dictionary</strong> The letters to use in sequence
generation (default are all amino acids)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences</a></span><span class="op">(</span>prefix.motif <span class="op">=</span> <span class="st">"CAS"</span>,</span>
<span>                               suffix.motif <span class="op">=</span> <span class="st">"YF"</span>,</span>
<span>                               number.of.sequences <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                               min.length <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                               max.length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASTCTMLANRYF"    "CASFTKNEEETYF"    "CASDGSGVAHHYF"    "CASDILAYWYEYF"   </span></span>
<span><span class="co">## [5] "CASADIMWPLCWYF"   "CASHIPRENTYATFYF"</span></span></code></pre>
<p>If we want to generate nucleotide sequences instead of amino acids,
we must to change the <strong>sequence.dictionary</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nucleotide.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences</a></span><span class="op">(</span>number.of.sequences <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                          min.length <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                          max.length <span class="op">=</span> <span class="fl">16</span>, </span>
<span>                                          sequence.dictionary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"T"</span>, <span class="st">"G"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nucleotide.sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "TGGTAGTG"         "TGTTGTTTGGGGTACG" "GACCCTCCTG"       "GGTCCCATGTCGCAT" </span></span>
<span><span class="co">## [5] "CAAGAATTAGGCTC"   "AGCTCGTGCTATCT"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="variationalsequences">variationalSequences<a class="anchor" aria-label="anchor" href="#variationalsequences"></a>
</h3>
<p>In addition to making random sequences with
<code><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences()</a></code>, we can also use generative deep
learning to simulate similar, de novo sequences with
<code><a href="https://rdrr.io/pkg/immApex/man/variationalSequences.html" class="external-link">variationalSequences()</a></code>. <code><a href="https://rdrr.io/pkg/immApex/man/variationalSequences.html" class="external-link">variationalSequences()</a></code>
uses a variational autoencoder that allows for sampling and generation
of sequences similar to the input sequences.</p>
<p>It should be noted that the success of this approach is highly
dependent on the number of sequences used as input and the
hyperparameters of the model. As such,
<code><a href="https://rdrr.io/pkg/immApex/man/variationalSequences.html" class="external-link">variationalSequences()</a></code> has a number of arguments to modify
to allow for optimization.</p>
<p>Parameters for `<code><a href="https://rdrr.io/pkg/immApex/man/variationalSequences.html" class="external-link">variationalSequences()</a></code></p>
<ul>
<li>
<strong>input.sequences</strong> The amino acid or nucleotide
sequences to use</li>
<li>
<strong>encoder.function</strong> The method to prepare the
sequencing information - <strong>“onehotEncoder”</strong> or
<strong>“propertyEncoder”</strong>
</li>
<li>
<strong>aa.method.to.use</strong> The method or approach to use for
the conversion, see <code><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder()</a></code>
</li>
<li>
<strong>number.of.sequences</strong> Number of sequences to
generate</li>
<li>
<strong>encoder.hidden.dim</strong> A vector of the neurons to use
in the hidden layers for the encoder portion of the model</li>
<li>
<strong>decoder.hidden.dim</strong> A vector of the neurons to use
in the hidden layers for the decoder portion of the model. If NULL
assumes symmetric autoencoder</li>
<li>
<strong>latent.dim</strong> The size of the latent dimensions</li>
<li>
<strong>batch.size</strong> The batch size to use for VAE
training</li>
<li>
<strong>epochs</strong> The number of epochs to use in VAE
training</li>
<li>
<strong>learning.rate</strong> The learning rate to use in VAE
training</li>
<li>
<strong>epsilon.std</strong> The epsilon to use in VAE training</li>
<li>
<strong>call.threshold</strong> The relative strictness of sequence
calling with higher values being more stringent</li>
<li>
<strong>activation.function</strong> The activation for the dense
connected layers</li>
<li>
<strong>optimizer</strong> The optimizer to use in VAE training</li>
<li>
<strong>disable.eager.execution</strong> Disable the eager execution
parameter for tensorflow.</li>
<li>
<strong>sequence.dictionary</strong> The letters to use in sequence
mutation (default are all amino acids)</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variational.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/variationalSequences.html" class="external-link">variationalSequences</a></span><span class="op">(</span><span class="va">sequences</span>, encoder <span class="op">=</span> <span class="st">"onehotEncoder"</span>, number.of.sequences <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    encoder.hidden.dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">256</span>, <span class="fl">128</span><span class="op">)</span>, latent.dim <span class="op">=</span> <span class="fl">16</span>, batch.size <span class="op">=</span> <span class="fl">16</span>, call.threshold <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 4/4 - 0s - 9ms/step</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">variational.sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASQARHMRSNY..F"  "CASDCVI.NKIYF"    "CASASIH.PFCDVFYF" "CAS.NACQGVITYF"  </span></span>
<span><span class="co">## [5] "CAS.QPSYTHGTYF"   "CASCHWNNI.M..YF"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="mutatesequences">mutateSequences<a class="anchor" aria-label="anchor" href="#mutatesequences"></a>
</h3>
<p>A common approach is to mutate sequences randomly or at specific
intervals. This can be particularly helpful if we have fewer sequences
or want to test a model for accuracy given new, altered sequences.
<code><a href="https://rdrr.io/pkg/immApex/man/mutateSequences.html" class="external-link">mutateSequences()</a></code> allows us to tune the type of mutation,
where along the sequences to introduce the mutation and the overall
number of mutations.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/mutateSequences.html" class="external-link">mutateSequences()</a></code></p>
<ul>
<li>
<strong>input.sequences</strong> The amino acid or nucleotide
sequences to use</li>
<li>
<strong>n.sequences</strong> The number of mutated sequences to
return per input.sequence</li>
<li>
<strong>mutation.rate</strong> The rate of mutations introduced into
sequences</li>
<li>
<strong>position.start</strong> The starting position to mutate
along the sequence. Default NULL will start the random mutations at
position 1.</li>
<li>
<strong>position.end</strong> The ending position to mutate along
the sequence. Default NULL will end the random mutations at the last
position.</li>
<li>
<strong>sequence.dictionary</strong> The letters to use in sequence
mutation (default are all amino acids)</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mutated.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/mutateSequences.html" class="external-link">mutateSequences</a></span><span class="op">(</span><span class="va">sequences</span>, </span>
<span>                                     n.sequence <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     position.start <span class="op">=</span> <span class="fl">3</span>,                                  </span>
<span>                                     position.end <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASTCTMLANRYF"    "CASFTKNEEETYF"    "CASDGSGVAHHYF"    "CASDILAYWYEYF"   </span></span>
<span><span class="co">## [5] "CASADIMWPLCWYF"   "CASHIPRENTYATFYF"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mutated.sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASTITMLANRYF"    "CASFTTNEEETYF"    "CAMDGSGVAHHYF"    "CASDGLAYWYEYF"   </span></span>
<span><span class="co">## [5] "CASPDIMWPLCWYF"   "CASYIPRENTYATFYF"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="formatgenes">formatGenes<a class="anchor" aria-label="anchor" href="#formatgenes"></a>
</h3>
<p>Immune receptor nomenclature can be highly variable across sequencing
platforms. When preparing data for models, we can use
`<code><a href="https://rdrr.io/pkg/immApex/man/formatGenes.html" class="external-link">formatGenes()</a></code> to universalize the gene formats into IMGT
nomenclature.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/formatGenes.html" class="external-link">formatGenes()</a></code></p>
<ul>
<li>
<strong>input.data</strong> Data frame of sequencing data or
scRepertoire outputs</li>
<li>
<strong>region</strong> Sequence gene loci to access - ‘v’, ‘d’,
‘j’, ‘c’ or a combination using c(‘v’, ‘d’, ‘j’)</li>
<li>
<strong>technology</strong> The sequencing technology employed -
‘TenX’, “Adaptive’, or ‘AIRR’</li>
<li>
<strong>species</strong> One or two word designation of species.
Currently supporting: “human”, “mouse”, “rat”, “rabbit”, “rhesus
monkey”, “sheep”, “pig”, “platypus”, “alpaca”, “dog”, “chicken”, and
“ferret”</li>
<li>
<strong>simplify.format</strong> If applicable, remove the allelic
designation (TRUE) or retain all information (FALSE)</li>
</ul>
<p>Here, we will use the built-in example from Adaptive Biotechnologies
and reformat and simplify the <strong>v</strong> region.
<code><a href="https://rdrr.io/pkg/immApex/man/formatGenes.html" class="external-link">formatGenes()</a></code> will add 2 columns to the end of the data
frame per region selected - 1) <strong>v_IMGT</strong> will be the
formatted gene calls and 2) <strong>v_IMGT.check</strong> is a binary
for if the formatted region appears in the IMGT database. In the example
below, “TRBV2-1” is not recognized as a designation within IMGT.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"immapex_example.data"</span><span class="op">)</span></span>
<span><span class="va">Adaptive_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/formatGenes.html" class="external-link">formatGenes</a></span><span class="op">(</span><span class="va">immapex_example.data</span><span class="op">[[</span><span class="st">"Adaptive"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                region <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>                                technology <span class="op">=</span> <span class="st">"Adaptive"</span>, </span>
<span>                                simplify.format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Adaptive_example</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aminoAcid"</span>,<span class="st">"vGeneName"</span>, <span class="st">"v_IMGT"</span>, <span class="st">"v_IMGT.check"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              aminoAcid  vGeneName   v_IMGT v_IMGT.check</span></span>
<span><span class="co">## 4490  CASSQDGPSGIETQYF TCRBV04-02  TRBV4-2            1</span></span>
<span><span class="co">## 18266    CASSEGSNQPQHF TCRBV02-01  TRBV2-1            0</span></span>
<span><span class="co">## 22061   CSASAGDMVTEAFF TCRBV20-01 TRBV20-1            1</span></span>
<span><span class="co">## 22174  CASSQDPGETDTQYF TCRBV03-01  TRBV3-1            1</span></span>
<span><span class="co">## 19117     CATSAWTGELFF TCRBV24-01 TRBV24-1            1</span></span>
<span><span class="co">## 2659     CATSVPGQETQYF TCRBV24-01 TRBV24-1            1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="getimgt">getIMGT<a class="anchor" aria-label="anchor" href="#getimgt"></a>
</h3>
<p>Depending on the sequencing technology and the version, we might want
to expand the length of our sequence embedding approach. The first step
in the process is pulling the reference sequences from the
ImMunoGeneTics (IMGT) system using <code><a href="https://rdrr.io/pkg/immApex/man/getIMGT.html" class="external-link">getIMGT()</a></code>. More
information for IMGT can be found at <a href="https://www.imgt.org/" class="external-link">imgt.org</a>. Data from IMGT is under a CC
BY-NC-ND 4.0 license. Please be aware that attribution is required for
usage and should not be used to create commercial or derivative
work.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/getIMGT.html" class="external-link">getIMGT()</a></code></p>
<ul>
<li>
<strong>species</strong> One or two word designation of species.
Currently supporting: “human”, “mouse”, “rat”, “rabbit”, “rhesus
monkey”, “sheep”, “pig”, “platypus”, “alpaca”, “dog”, “chicken”, and
“ferret”</li>
<li>
<strong>chain</strong> Sequence chain to access</li>
<li>
<strong>frame</strong> Designation for “all”, “inframe” or
“inframe+gap”</li>
<li>
<strong>region</strong> Sequence gene loci to access</li>
<li>
<strong>sequence.type</strong> Type of sequence - “aa” for amino
acid or “nt” for nucleotide</li>
</ul>
<p>Here, we will use the <code><a href="https://rdrr.io/pkg/immApex/man/getIMGT.html" class="external-link">getIMGT()</a></code> function to get the
amino acid sequences for the TRBV region to get all the sequences by V
gene allele.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TRBV_aa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/getIMGT.html" class="external-link">getIMGT</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"human"</span>,</span>
<span>                   chain <span class="op">=</span> <span class="st">"TRB"</span>,</span>
<span>                   frame <span class="op">=</span> <span class="st">"inframe"</span>,</span>
<span>                   region <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>                   sequence.type <span class="op">=</span> <span class="st">"aa"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">TRBV_aa</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $`TRBV1*01`</span></span>
<span><span class="co">## [1] "TRBVHPVREGIONAADTGITQTPKYLVTAMGSKRTMKREHLGHDSMYWYRQKAKKSLEFMFYYNCKEFIENKTVPNHFTPECPDSSRLYLHVVALQQEDSAAYLCTSSQ"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="infercdr">inferCDR<a class="anchor" aria-label="anchor" href="#infercdr"></a>
</h3>
<p>We can now use <code><a href="https://rdrr.io/pkg/immApex/man/inferCDR.html" class="external-link">inferCDR()</a></code> to add additional sequence
elements to our example data using the outputs of
<code><a href="https://rdrr.io/pkg/immApex/man/formatGenes.html" class="external-link">formatGenes()</a></code> and <code><a href="https://rdrr.io/pkg/immApex/man/getIMGT.html" class="external-link">getIMGT()</a></code>. Here, we will use
the function to isolate the complementarity-determining regions (CDR) 1
and 2. If the gene nomenclature does not match the IMGT the result will
be NA for the given sequences. Likewise, if the IMGT nomenclature has
been simplified, the first allelic match will be used for sequence
extraction.</p>
<p>Parameters for <code>inferCDR</code></p>
<ul>
<li>
<strong>input.data</strong> Data frame of sequencing data or output
from formatGenes().</li>
<li>
<strong>reference</strong> IMGT sequences from
<code><a href="https://rdrr.io/pkg/immApex/man/getIMGT.html" class="external-link">getIMGT()</a></code>
</li>
<li>
<strong>technology</strong> The sequencing technology employed -
‘TenX’, “Adaptive’, or ‘AIRR’,</li>
<li>
<strong>sequence.type</strong> Type of sequence - “aa” for amino
acid or “nt” for nucleotide</li>
<li>
<strong>sequences</strong> The specific regions of the CDR loop to
get from the data.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Adaptive_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/inferCDR.html" class="external-link">inferCDR</a></span><span class="op">(</span><span class="va">Adaptive_example</span>,</span>
<span>                             chain <span class="op">=</span> <span class="st">"TRB"</span>, </span>
<span>                             reference <span class="op">=</span> <span class="va">TRBV_aa</span>,</span>
<span>                             technology <span class="op">=</span> <span class="st">"Adaptive"</span>, </span>
<span>                             sequence.type <span class="op">=</span> <span class="st">"aa"</span>,</span>
<span>                             sequences <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CDR1"</span>, <span class="st">"CDR2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Adaptive_example</span><span class="op">[</span><span class="fl">200</span><span class="op">:</span><span class="fl">210</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CDR1_IMGT"</span>, <span class="st">"CDR2_IMGT"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##        CDR1_IMGT  CDR2_IMGT</span></span>
<span><span class="co">## 200 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 201 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 202 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 203 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 204 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 205 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 206 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 207 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 208 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 209 IIEKRQSVAFWC QGPKLLIQFQ</span></span>
<span><span class="co">## 210 IIEKRQSVAFWC QGPKLLIQFQ</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="encoders">Encoders<a class="anchor" aria-label="anchor" href="#encoders"></a>
</h2>
<div class="section level3">
<h3 id="onehotencoder">onehotEncoder<a class="anchor" aria-label="anchor" href="#onehotencoder"></a>
</h3>
<p>One hot encoding of amino acid or nucleotide sequences is a common
method for transforming sequences into numeric matrices compatible with
Keras (or other workflows).</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/onehotEncoder.html" class="external-link">onehotEncoder()</a></code></p>
<ul>
<li>
<strong>input.sequences</strong> The amino acid or nucleotide
sequences to use</li>
<li>
<strong>max.length</strong> Additional length to pad, NULL will pad
sequences to the max length of input.sequences</li>
<li>
<strong>convert.to.matrix</strong> Return a matrix
(<strong>TRUE</strong>) or a 3D array (<strong>FALSE</strong>)</li>
<li>
<strong>sequence.dictionary</strong> The letters to use in encoding
(default are all amino acids + NA value)</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/onehotEncoder.html" class="external-link">onehotEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, </span>
<span>                                 convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sequence.matrix</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Pos.1_A Pos.1_R Pos.1_N Pos.1_D Pos.1_C Pos.1_Q Pos.1_E Pos.1_G Pos.1_H</span></span>
<span><span class="co">## [1,]       0       0       0       0       1       0       0       0       0</span></span>
<span><span class="co">## [2,]       0       0       0       0       1       0       0       0       0</span></span>
<span><span class="co">## [3,]       0       0       0       0       1       0       0       0       0</span></span>
<span><span class="co">## [4,]       0       0       0       0       1       0       0       0       0</span></span>
<span><span class="co">## [5,]       0       0       0       0       1       0       0       0       0</span></span>
<span><span class="co">## [6,]       0       0       0       0       1       0       0       0       0</span></span>
<span><span class="co">##      Pos.1_I Pos.1_L Pos.1_K Pos.1_M Pos.1_F Pos.1_P Pos.1_S Pos.1_T Pos.1_W</span></span>
<span><span class="co">## [1,]       0       0       0       0       0       0       0       0       0</span></span>
<span><span class="co">## [2,]       0       0       0       0       0       0       0       0       0</span></span>
<span><span class="co">## [3,]       0       0       0       0       0       0       0       0       0</span></span>
<span><span class="co">## [4,]       0       0       0       0       0       0       0       0       0</span></span>
<span><span class="co">## [5,]       0       0       0       0       0       0       0       0       0</span></span>
<span><span class="co">## [6,]       0       0       0       0       0       0       0       0       0</span></span>
<span><span class="co">##      Pos.1_Y Pos.1_V</span></span>
<span><span class="co">## [1,]       0       0</span></span>
<span><span class="co">## [2,]       0       0</span></span>
<span><span class="co">## [3,]       0       0</span></span>
<span><span class="co">## [4,]       0       0</span></span>
<span><span class="co">## [5,]       0       0</span></span>
<span><span class="co">## [6,]       0       0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="propertyencoder">propertyEncoder<a class="anchor" aria-label="anchor" href="#propertyencoder"></a>
</h3>
<p>An alternative to one hot encoding is transforming the sequences into
an array/matrix of numerical values using amino acid properties.</p>
<p>These properties are largely based on dimensional reduction
strategies, but it is essential to know the assumptions for each
approach (links to original work below). <strong>Important to note:
</strong> this encoding strategy is specific for amino acids.</p>
<p><strong>method.to.use</strong></p>
<ul>
<li>atchleyFactors - <a href="https://pubmed.ncbi.nlm.nih.gov/15851683/" class="external-link">citation</a>
</li>
<li>crucianiProperties - <a href="https://analyticalsciencejournals.onlinelibrary.wiley.com/doi/abs/10.1002/cem.856" class="external-link">citation</a>
</li>
<li>FASGAI - <a href="https://pubmed.ncbi.nlm.nih.gov/18318694/" class="external-link">citation</a>
</li>
<li>kideraFactors - <a href="https://link.springer.com/article/10.1007/BF01025492" class="external-link">citation</a>
</li>
<li>MSWHIM - <a href="https://pubs.acs.org/doi/10.1021/ci980211b" class="external-link">citation</a>
</li>
<li>ProtFP - <a href="https://pubmed.ncbi.nlm.nih.gov/24059694/" class="external-link">citation</a>
</li>
<li>stScales - <a href="https://pubmed.ncbi.nlm.nih.gov/19373543/" class="external-link">citation</a>
</li>
<li>tScales - <a href="https://www.sciencedirect.com/science/article/abs/pii/S0022286006006314" class="external-link">citation</a>
</li>
<li>VHSE - <a href="https://pubmed.ncbi.nlm.nih.gov/15895431/" class="external-link">citation</a>
</li>
<li>zScales - <a href="https://pubmed.ncbi.nlm.nih.gov/9651153/" class="external-link">citation</a>
</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">property.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, </span>
<span>                                   method.to.use <span class="op">=</span> <span class="st">"FASGAI"</span>,</span>
<span>                                   convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">property.matrix</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       Pos.1_F1  Pos.1_F2   Pos.1_F3 Pos.1_F4 Pos.1_F5  Pos.1_F6  Pos.2_F1</span></span>
<span><span class="co">## [1,] 0.8189626 0.6210147 0.06362416        0 0.063684 0.5042316 0.5475782</span></span>
<span><span class="co">## [2,] 0.8189626 0.6210147 0.06362416        0 0.063684 0.5042316 0.5475782</span></span>
<span><span class="co">## [3,] 0.8189626 0.6210147 0.06362416        0 0.063684 0.5042316 0.5475782</span></span>
<span><span class="co">## [4,] 0.8189626 0.6210147 0.06362416        0 0.063684 0.5042316 0.5475782</span></span>
<span><span class="co">## [5,] 0.8189626 0.6210147 0.06362416        0 0.063684 0.5042316 0.5475782</span></span>
<span><span class="co">## [6,] 0.8189626 0.6210147 0.06362416        0 0.063684 0.5042316 0.5475782</span></span>
<span><span class="co">##       Pos.2_F2  Pos.2_F3  Pos.2_F4  Pos.2_F5  Pos.2_F6  Pos.3_F1  Pos.3_F2</span></span>
<span><span class="co">## [1,] 0.8428057 0.1736913 0.8702309 0.2374043 0.2587973 0.3064239 0.3803715</span></span>
<span><span class="co">## [2,] 0.8428057 0.1736913 0.8702309 0.2374043 0.2587973 0.3064239 0.3803715</span></span>
<span><span class="co">## [3,] 0.8428057 0.1736913 0.8702309 0.2374043 0.2587973 0.3064239 0.3803715</span></span>
<span><span class="co">## [4,] 0.8428057 0.1736913 0.8702309 0.2374043 0.2587973 0.3064239 0.3803715</span></span>
<span><span class="co">## [5,] 0.8428057 0.1736913 0.8702309 0.2374043 0.2587973 0.3064239 0.3803715</span></span>
<span><span class="co">## [6,] 0.8428057 0.1736913 0.8702309 0.2374043 0.2587973 0.3064239 0.3803715</span></span>
<span><span class="co">##       Pos.3_F3  Pos.3_F4  Pos.3_F5  Pos.3_F6   Pos.4_F1  Pos.4_F2</span></span>
<span><span class="co">## [1,] 0.1548993 0.6681727 0.2317614 0.3772829 0.46547578 0.4904353</span></span>
<span><span class="co">## [2,] 0.1548993 0.6681727 0.2317614 0.3772829 0.90484370 0.6964236</span></span>
<span><span class="co">## [3,] 0.1548993 0.6681727 0.2317614 0.3772829 0.03057369 0.4920987</span></span>
<span><span class="co">## [4,] 0.1548993 0.6681727 0.2317614 0.3772829 0.03057369 0.4920987</span></span>
<span><span class="co">## [5,] 0.1548993 0.6681727 0.2317614 0.3772829 0.54757815 0.8428057</span></span>
<span><span class="co">## [6,] 0.1548993 0.6681727 0.2317614 0.3772829 0.38371694 0.7429997</span></span></code></pre>
<p><code><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder()</a></code> also allows us to use multiple
approaches simultaneously by setting <strong>method.to.use</strong> as a
vector.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mulit.property.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, </span>
<span>                                         method.to.use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"atchleyFactors"</span>, <span class="st">"kideraFactors"</span><span class="op">)</span>,</span>
<span>                                         convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mulit.property.matrix</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Pos.1_AF1 Pos.1_AF2 Pos.1_AF3 Pos.1_AF4 Pos.1_AF5 Pos.1_KF1 Pos.1_KF2</span></span>
<span><span class="co">## [1,]         0  0.551818 0.4960678 0.2994783 0.4864792 0.4640884 0.2635468</span></span>
<span><span class="co">## [2,]         0  0.551818 0.4960678 0.2994783 0.4864792 0.4640884 0.2635468</span></span>
<span><span class="co">## [3,]         0  0.551818 0.4960678 0.2994783 0.4864792 0.4640884 0.2635468</span></span>
<span><span class="co">## [4,]         0  0.551818 0.4960678 0.2994783 0.4864792 0.4640884 0.2635468</span></span>
<span><span class="co">## [5,]         0  0.551818 0.4960678 0.2994783 0.4864792 0.4640884 0.2635468</span></span>
<span><span class="co">## [6,]         0  0.551818 0.4960678 0.2994783 0.4864792 0.4640884 0.2635468</span></span>
<span><span class="co">##      Pos.1_KF3 Pos.1_KF4 Pos.1_KF5 Pos.1_KF6 Pos.1_KF7 Pos.1_KF8 Pos.1_KF9</span></span>
<span><span class="co">## [1,] 0.5643836 0.1511628 0.2675676         1         1 0.3454936 0.8553616</span></span>
<span><span class="co">## [2,] 0.5643836 0.1511628 0.2675676         1         1 0.3454936 0.8553616</span></span>
<span><span class="co">## [3,] 0.5643836 0.1511628 0.2675676         1         1 0.3454936 0.8553616</span></span>
<span><span class="co">## [4,] 0.5643836 0.1511628 0.2675676         1         1 0.3454936 0.8553616</span></span>
<span><span class="co">## [5,] 0.5643836 0.1511628 0.2675676         1         1 0.3454936 0.8553616</span></span>
<span><span class="co">## [6,] 0.5643836 0.1511628 0.2675676         1         1 0.3454936 0.8553616</span></span>
<span><span class="co">##      Pos.1_KF10 Pos.2_AF1  Pos.2_AF2 Pos.2_AF3 Pos.2_AF4 Pos.2_AF5</span></span>
<span><span class="co">## [1,]  0.8661616 0.2366665 0.06143816 0.5124824         1 0.5043415</span></span>
<span><span class="co">## [2,]  0.8661616 0.2366665 0.06143816 0.5124824         1 0.5043415</span></span>
<span><span class="co">## [3,]  0.8661616 0.2366665 0.06143816 0.5124824         1 0.5043415</span></span>
<span><span class="co">## [4,]  0.8661616 0.2366665 0.06143816 0.5124824         1 0.5043415</span></span>
<span><span class="co">## [5,]  0.8661616 0.2366665 0.06143816 0.5124824         1 0.5043415</span></span>
<span><span class="co">## [6,]  0.8661616 0.2366665 0.06143816 0.5124824         1 0.5043415</span></span></code></pre>
<p>If, instead, we would like to get the set of summarized values across
all amino acid residues for a given <strong>method.to.use</strong>, we
can use <strong>summary.function</strong> and select “median”, “mean”,
“sum”, variance (“vars”), or Median Absolute Deviation (“mads”).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">median.property.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, </span>
<span>                                          method.to.use <span class="op">=</span> <span class="st">"crucianiProperties"</span>,</span>
<span>                                          summary.function <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">median.property.matrix</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         PP1    PP2    PP3</span></span>
<span><span class="co">## [1,] 0.1575 0.1975 0.5525</span></span>
<span><span class="co">## [2,] 0.6775 0.2225 0.3050</span></span>
<span><span class="co">## [3,] 0.0675 0.1050 0.6250</span></span>
<span><span class="co">## [4,] 0.1500 0.2475 0.3900</span></span>
<span><span class="co">## [5,] 0.0925 0.2825 0.4050</span></span>
<span><span class="co">## [6,] 0.6550 0.2825 0.5525</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="geometricencoder">geometricEncoder<a class="anchor" aria-label="anchor" href="#geometricencoder"></a>
</h3>
<p>One approach to encoding amino acid sequences is geometric isometry,
such as <a href="https://pubmed.ncbi.nlm.nih.gov/34349111/" class="external-link">GIANA</a>.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/geometricEncoder.html" class="external-link">geometricEncoder()</a></code></p>
<ul>
<li>
<strong>method.to.use</strong> Select the following substitution
matrices: “BLOSUM45”, “BLOSUM50”, “BLOSUM62”, “BLOSUM80”, “BLOSUM100”,
“PAM30”, “PAM40”, “PAM70”, “PAM120”, or “PAM250”</li>
<li>
<strong>theta</strong> The angle in which to create the rotation
matrix</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geometric.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/geometricEncoder.html" class="external-link">geometricEncoder</a></span><span class="op">(</span><span class="va">sequences</span>, </span>
<span>                                     method.to.use <span class="op">=</span> <span class="st">"BLOSUM62"</span>,</span>
<span>                                     theta <span class="op">=</span> <span class="va">pi</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">geometric.matrix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            [,1]        [,2]       [,3]        [,4]       [,5]       [,6]</span></span>
<span><span class="co">## [1,] -0.9326427 -0.53846154 -2.2320508 -0.13397460 -0.8838755 -0.7767751</span></span>
<span><span class="co">## [2,] -1.1352562 -0.03367863 -0.8969426  0.01508865 -1.0920117  0.9683429</span></span>
<span><span class="co">## [3,] -1.3989641 -0.80769231 -1.3172581  0.12771185 -1.4992601  0.2891023</span></span>
<span><span class="co">## [4,] -1.9346642 -0.49521709 -2.3886584  0.75266228 -1.4889543  0.1174061</span></span>
<span><span class="co">## [5,] -2.1057687 -0.63841587 -2.9010526  0.88191339 -1.3608971 -0.7857143</span></span>
<span><span class="co">## [6,] -1.1930286 -0.18361389 -1.7906647 -0.02347777 -1.4597754  0.5284052</span></span>
<span><span class="co">##            [,7]        [,8]      [,9]      [,10]     [,11]       [,12]</span></span>
<span><span class="co">## [1,] -2.5115873  0.50404299 -1.491716  0.7375736 -1.373570 -0.08244591</span></span>
<span><span class="co">## [2,] -1.5603546 -0.98969426 -1.850197 -0.1799805 -1.207396  1.16819488</span></span>
<span><span class="co">## [3,] -0.9100098  0.80695239 -1.465581 -0.8461538 -2.227268  0.93466424</span></span>
<span><span class="co">## [4,] -2.5191316  0.05557168 -1.194329  0.3763311 -1.888658 -0.11336312</span></span>
<span><span class="co">## [5,] -2.8557687  0.66062224 -1.635165  1.1179025 -2.027335 -0.34569614</span></span>
<span><span class="co">## [6,] -2.2091742 -0.04859801 -1.270032 -0.3002405 -1.684655  0.54290834</span></span>
<span><span class="co">##           [,13]       [,14]      [,15]    [,16]      [,17]      [,18]</span></span>
<span><span class="co">## [1,] -0.8866369 -0.15660757 -1.1050789 1.760207 -1.5218931 -1.0563116</span></span>
<span><span class="co">## [2,] -1.2430965  0.61464470 -0.8564596 1.637278 -1.5988161 -0.9230769</span></span>
<span><span class="co">## [3,] -1.5583331  0.69911210 -0.8949211 1.703895 -2.1935893 -0.2005919</span></span>
<span><span class="co">## [4,] -0.2513807  0.74309646 -1.8584811 1.680522 -0.8715482  0.7403351</span></span>
<span><span class="co">## [5,] -0.5497252  0.09500907 -1.6708789 1.179761 -0.6237179  0.7945968</span></span>
<span><span class="co">## [6,] -0.9330127  0.61602540 -1.0518829 1.196915 -1.6405445 -0.6584936</span></span>
<span><span class="co">##           [,19]      [,20]</span></span>
<span><span class="co">## [1,] -1.0507888  0.2815580</span></span>
<span><span class="co">## [2,] -1.4017255 -0.1875248</span></span>
<span><span class="co">## [3,] -1.4298813 -0.2926037</span></span>
<span><span class="co">## [4,] -0.3097138 -1.1558676</span></span>
<span><span class="co">## [5,] -0.9208789 -0.1192766</span></span>
<span><span class="co">## [6,] -0.9201520 -0.5312500</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="tokenizesequences">tokenizeSequences<a class="anchor" aria-label="anchor" href="#tokenizesequences"></a>
</h3>
<p>Another approach to transforming a sequence into numerical values is
tokenizing it into numbers. This is a common approach for recurrent
neural networks where one letter corresponds to a single integer. In
addition, we can add start and stop tokens to our original sequences to
differentiate between the beginning and end of the sequences.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/tokenizeSequences.html" class="external-link">tokenizeSequences()</a></code></p>
<ul>
<li>
<strong>add.startstop</strong> Add start and stop tokens to the
sequence</li>
<li>
<strong>start.token</strong> The character to use for the start
token</li>
<li>
<strong>stop.token</strong> The character to use for the stop
token</li>
<li>
<strong>max.length</strong> Additional length to pad, NULL will pad
sequences to the max length of input.sequences</li>
<li>
<strong>convert.to.matrix</strong> Return a matrix
(<strong>TRUE</strong>) or a vector (<strong>FALSE</strong>)</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">token.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/tokenizeSequences.html" class="external-link">tokenizeSequences</a></span><span class="op">(</span>input.sequences <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, </span>
<span>                                  add.startstop <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  start.token <span class="op">=</span> <span class="st">"!"</span>,</span>
<span>                                  stop.token <span class="op">=</span> <span class="st">"^"</span>, </span>
<span>                                  convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">token.matrix</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]</span></span>
<span><span class="co">## CASTCTMLANRYF       1    6    2   17   18    6   18   14   12     2     4     3</span></span>
<span><span class="co">## CASFTKNEEETYF       1    6    2   17   15   18   13    4    8     8     8    18</span></span>
<span><span class="co">## CASDGSGVAHHYF       1    6    2   17    5    9   17    9   21     2    10    10</span></span>
<span><span class="co">## CASDILAYWYEYF       1    6    2   17    5   11   12    2   20    19    20     8</span></span>
<span><span class="co">## CASADIMWPLCWYF      1    6    2   17    2    5   11   14   19    16    12     6</span></span>
<span><span class="co">## CASHIPRENTYATFYF    1    6    2   17   10   11   16    3    8     4    18    20</span></span>
<span><span class="co">##                  [,13] [,14] [,15] [,16] [,17] [,18]</span></span>
<span><span class="co">## CASTCTMLANRYF       20    15    22    23    23    23</span></span>
<span><span class="co">## CASFTKNEEETYF       20    15    22    23    23    23</span></span>
<span><span class="co">## CASDGSGVAHHYF       20    15    22    23    23    23</span></span>
<span><span class="co">## CASDILAYWYEYF       20    15    22    23    23    23</span></span>
<span><span class="co">## CASADIMWPLCWYF      19    20    15    22    23    23</span></span>
<span><span class="co">## CASHIPRENTYATFYF     2    18    15    20    15    22</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="probabilitymatrix">probabilityMatrix<a class="anchor" aria-label="anchor" href="#probabilitymatrix"></a>
</h3>
<p>Another method for encoding a group of sequences is to calculate the
positional probability of sequences using
<code>probabilityMatrixs()</code>. This function could represent a
collection of antigen-specific sequences or even work on embedding a
total repertoire.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ppm.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/probabilityMatrix.html" class="external-link">probabilityMatrix</a></span><span class="op">(</span><span class="va">sequences</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ppm.matrix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Pos.1 Pos.2 Pos.3 Pos.4 Pos.5 Pos.6 Pos.7 Pos.8 Pos.9 Pos.10 Pos.11 Pos.12</span></span>
<span><span class="co">## A     0     1     0 0.055 0.063 0.054 0.041 0.042 0.051  0.059  0.060  0.044</span></span>
<span><span class="co">## R     0     0     0 0.050 0.053 0.045 0.044 0.059 0.058  0.052  0.057  0.035</span></span>
<span><span class="co">## N     0     0     0 0.057 0.058 0.043 0.054 0.050 0.044  0.065  0.046  0.029</span></span>
<span><span class="co">## D     0     0     0 0.062 0.057 0.049 0.056 0.055 0.054  0.049  0.054  0.045</span></span>
<span><span class="co">## C     1     0     0 0.048 0.042 0.054 0.056 0.049 0.050  0.035  0.050  0.042</span></span>
<span><span class="co">## Q     0     0     0 0.051 0.049 0.057 0.046 0.050 0.056  0.049  0.048  0.030</span></span>
<span><span class="co">##   Pos.13 Pos.14 Pos.15 Pos.16</span></span>
<span><span class="co">## A  0.023  0.011      0      0</span></span>
<span><span class="co">## R  0.022  0.013      0      0</span></span>
<span><span class="co">## N  0.027  0.014      0      0</span></span>
<span><span class="co">## D  0.020  0.014      0      0</span></span>
<span><span class="co">## C  0.025  0.014      0      0</span></span>
<span><span class="co">## Q  0.020  0.013      0      0</span></span></code></pre>
<p>In addition, <code><a href="https://rdrr.io/pkg/immApex/man/probabilityMatrix.html" class="external-link">probabilityMatrix()</a></code> can convert the
positional probability matrix into a positional weight matrix using
log-likelihood using the argument <strong>convert.PWM</strong> = TRUE.
We can provide a set of background frequencies for the amino acids with
<strong>background.frequencies</strong> or leave this blank to assume a
uniform distribution for all amino acids. Here, we are going to use an
example background.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">back.freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">back.freq</span> <span class="op">&lt;-</span> <span class="va">back.freq</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">back.freq</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwm.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/probabilityMatrix.html" class="external-link">probabilityMatrix</a></span><span class="op">(</span><span class="va">sequences</span>,</span>
<span>                                max.length <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                convert.PWM <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                background.frequencies <span class="op">=</span> <span class="va">back.freq</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pwm.matrix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       Pos.1     Pos.2     Pos.3      Pos.4      Pos.5      Pos.6      Pos.7</span></span>
<span><span class="co">## A -6.157338  3.809888 -6.157338 -0.3499835 -0.1573384 -0.3759787 -0.7650210</span></span>
<span><span class="co">## R -6.986931 -6.986931 -6.986931 -1.3145058 -1.2320437 -1.4633692 -1.4950781</span></span>
<span><span class="co">## N -5.351911 -5.351911 -5.351911  0.5060700  0.5307321  0.1075207  0.4294488</span></span>
<span><span class="co">## D -4.282869 -4.282869 -4.282869  1.6944106  1.5751117  1.3609869  1.5500207</span></span>
<span><span class="co">## C  6.732291 -3.234935 -3.234935  2.3797750  2.1913299  2.5464249  2.5979552</span></span>
<span><span class="co">## Q -4.858371 -4.858371 -4.858371  0.8420682  0.7854847  0.9996095  0.6962174</span></span>
<span><span class="co">##        Pos.8      Pos.9     Pos.10     Pos.11      Pos.12     Pos.13     Pos.14</span></span>
<span><span class="co">## A -0.7310737 -0.4568987 -0.2504478 -0.2266011 -0.66548534 -1.5723759 -2.5723759</span></span>
<span><span class="co">## R -1.0800406 -1.1042881 -1.2590107 -1.1289502 -1.81700617 -2.4633692 -3.1795762</span></span>
<span><span class="co">## N  0.3205144  0.1399421  0.6924832  0.2026779 -0.44502037 -0.5445560 -1.4450204</span></span>
<span><span class="co">## D  1.5244856  1.4984904  1.3609869  1.4984904  1.24069264  0.1094481 -0.3759787</span></span>
<span><span class="co">## C  2.4089214  2.4374905  1.9349902  2.4374905  2.19132992  1.4655049  0.6719558</span></span>
<span><span class="co">## Q  0.8140539  0.9745185  0.7854847  0.7563384  0.09582482 -0.4660541 -1.0510166</span></span>
<span><span class="co">##      Pos.15    Pos.16    Pos.17    Pos.18    Pos.19    Pos.20</span></span>
<span><span class="co">## A -6.157338 -6.157338 -6.157338 -6.157338 -6.157338 -6.157338</span></span>
<span><span class="co">## R -6.986931 -6.986931 -6.986931 -6.986931 -6.986931 -6.986931</span></span>
<span><span class="co">## N -5.351911 -5.351911 -5.351911 -5.351911 -5.351911 -5.351911</span></span>
<span><span class="co">## D -4.282869 -4.282869 -4.282869 -4.282869 -4.282869 -4.282869</span></span>
<span><span class="co">## C -3.234935 -3.234935 -3.234935 -3.234935 -3.234935 -3.234935</span></span>
<span><span class="co">## Q -4.858371 -4.858371 -4.858371 -4.858371 -4.858371 -4.858371</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adjacencymatrix">adjacencyMatrix<a class="anchor" aria-label="anchor" href="#adjacencymatrix"></a>
</h3>
<p>Similar to the positional probability, we can also summarize a given
set of sequences by the frequency of adjacency for a given set of amino
acid or nucleotide residues using <code><a href="https://rdrr.io/pkg/immApex/man/adjacencyMatrix.html" class="external-link">adjacencyMatrix()</a></code>. For
this function, a matrix of n x n (defined by the length of
<strong>sequence.dictionary</strong>) is created and the number of times
a residue is adjacent to one another is calculated. We can
<strong>normalize</strong> the values using the total number of residues
evaluated.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/adjacencyMatrix.html" class="external-link">adjacencyMatrix</a></span><span class="op">(</span><span class="va">sequences</span>, </span>
<span>                              normalize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">adj.matrix</span></span></code></pre></div>
<pre><code><span><span class="co">##      A  R   N   D    C  Q   E   G  H  I  L   K  M    F   P    S   T   W    Y  V</span></span>
<span><span class="co">## A   34 56  40  37 1052 51  47  51 48 47 39  50 42   38  47 1089  37  49  113 39</span></span>
<span><span class="co">## R   56 56  54  52   39 36  34  36 42 42 52  41 41   28  50   97  50  39   90 41</span></span>
<span><span class="co">## N   40 54  44  48   37 52  45  48 31 40 43  42 43   34  44  100  49  50   92 38</span></span>
<span><span class="co">## D   37 52  48  34   36 50  47  47 40 41 44  46 36   41  42  116  61  45  110 57</span></span>
<span><span class="co">## C 1052 39  37  36   44 43  46  41 40 40 49  48 38   32  44   87  42  39   84 49</span></span>
<span><span class="co">## Q   51 36  52  50   43 34  47  43 48 48 38  42 38   31  43   96  34  43   77 44</span></span>
<span><span class="co">## E   47 34  45  47   46 47  52  48 38 41 37  33 44   36  41   92  50  45  111 36</span></span>
<span><span class="co">## G   51 36  48  47   41 43  48  42 38 32 30  42 50   37  49  102  40  57   80 29</span></span>
<span><span class="co">## H   48 42  31  40   40 48  38  38 28 39 42  48 35   45  47   99  52  34   72 46</span></span>
<span><span class="co">## I   47 42  40  41   40 48  41  32 39 44 39  40 43   35  43   71  32  49   90 38</span></span>
<span><span class="co">## L   39 52  43  44   49 38  37  30 42 39 36  43 36   39  47   82  42  51   97 36</span></span>
<span><span class="co">## K   50 41  42  46   48 42  33  42 48 40 43  38 38   45  36   82  40  42  100 40</span></span>
<span><span class="co">## M   42 41  43  36   38 38  44  50 35 43 36  38 38   32  35   86  40  40   78 45</span></span>
<span><span class="co">## F   38 28  34  41   32 31  36  37 45 35 39  45 32   34  40   78  41  32 1082 34</span></span>
<span><span class="co">## P   47 50  44  42   44 43  41  49 47 43 47  36 35   40  52  113  38  47  110 34</span></span>
<span><span class="co">## S 1089 97 100 116   87 96  92 102 99 71 82  82 86   78 113  166  88  88  131 95</span></span>
<span><span class="co">## T   37 50  49  61   42 34  50  40 52 32 42  40 40   41  38   88  50  43  106 39</span></span>
<span><span class="co">## W   49 39  50  45   39 43  45  57 34 49 51  42 40   32  47   88  43  56  105 36</span></span>
<span><span class="co">## Y  113 90  92 110   84 77 111  80 72 90 97 100 78 1082 110  131 106 105  146 66</span></span>
<span><span class="co">## V   39 41  38  57   49 44  36  29 46 38 36  40 45   34  34   95  39  36   66 38</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="extracting-sequences">Extracting Sequences<a class="anchor" aria-label="anchor" href="#extracting-sequences"></a>
</h2>
<div class="section level3">
<h3 id="sequencedecoder">sequenceDecoder<a class="anchor" aria-label="anchor" href="#sequencedecoder"></a>
</h3>
<p>We have a function called <code><a href="https://rdrr.io/pkg/immApex/man/sequenceDecoder.html" class="external-link">sequenceDecoder()</a></code> that
extracts sequences from one-hot or property-encoded matrices or arrays.
This function can be applied to any generative approach to sequence
generation.</p>
<p>Parameters for <code><a href="https://rdrr.io/pkg/immApex/man/sequenceDecoder.html" class="external-link">sequenceDecoder()</a></code></p>
<ul>
<li>
<strong>sequence.matrix</strong> The encoded sequences to decode in
an array or matrix</li>
<li>
<strong>encoder</strong> The method to prepare the sequencing
information - “onehotEncoder” or “propertyEncoder”</li>
<li>
<strong>aa.method.to.use</strong> The method or approach to use for
the conversion corresponding to the input to
<code><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder()</a></code>. This will be ignored if
<strong>encoder</strong> = “onehotEncoder”</li>
<li>
<strong>call.threshold</strong> The relative strictness of sequence
calling with higher values being more stringent</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">property.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/propertyEncoder.html" class="external-link">propertyEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, method.to.use <span class="op">=</span> <span class="st">"FASGAI"</span>,</span>
<span>    convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">property.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/sequenceDecoder.html" class="external-link">sequenceDecoder</a></span><span class="op">(</span><span class="va">property.matrix</span>, encoder <span class="op">=</span> <span class="st">"propertyEncoder"</span>, aa.method.to.use <span class="op">=</span> <span class="st">"FASGAI"</span>,</span>
<span>    call.threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASTCTMLANRYF"    "CASFTKNEEETYF"    "CASDGSGVAHHYF"    "CASDILAYWYEYF"   </span></span>
<span><span class="co">## [5] "CASADIMWPLCWYF"   "CASHIPRENTYATFYF"</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">property.sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASTCTMLANRYF"    "CASFTKNEEETYF"    "CASDGSGVAHHYF"    "CASDILAYWYEYF"   </span></span>
<span><span class="co">## [5] "CASADIMWPLCWYF"   "CASHIPRENTYATFYF"</span></span></code></pre>
<p>A similar approach can be applied when using matrices or arrays
derived from one-hot encoding:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/onehotEncoder.html" class="external-link">onehotEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sequences</span>, <span class="va">mutated.sequences</span><span class="op">)</span>, convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">OHE.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/sequenceDecoder.html" class="external-link">sequenceDecoder</a></span><span class="op">(</span><span class="va">sequence.matrix</span>, encoder <span class="op">=</span> <span class="st">"onehotEncoder"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">OHE.sequences</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CASTCTMLANRYF"    "CASFTKNEEETYF"    "CASDGSGVAHHYF"    "CASDILAYWYEYF"   </span></span>
<span><span class="co">## [5] "CASADIMWPLCWYF"   "CASHIPRENTYATFYF"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="training-a-model">Training a Model<a class="anchor" aria-label="anchor" href="#training-a-model"></a>
</h2>
<div class="section level3">
<h3 id="autoencoder">Autoencoder<a class="anchor" aria-label="anchor" href="#autoencoder"></a>
</h3>
<p>For the vignette - we will use an autoencoder for sequence embedding.
The code below is based on the <a href="https://github.com/BorchLab/Trex" class="external-link">Trex</a> R package. The overall
structure of the autoencoder is the same. However, some of the
parameters are modified for the sake of the vignette. We will use the
<strong>sequence.matrix</strong> we generated above from the
<code><a href="https://rdrr.io/pkg/immApex/man/onehotEncoder.html" class="external-link">onehotEncoder()</a></code>.</p>
<p>The steps to train the model include:</p>
<ol style="list-style-type: decimal">
<li>Subsetting sequences</li>
<li>Defining parameters for the model</li>
<li>Forming the autoencoder structure - encoder and decoder</li>
<li>Fitting the model</li>
</ol>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Sampling to make Training/Validation Data Cohorts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">num_sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sequence.matrix</span><span class="op">)</span></span>
<span><span class="va">indices</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_sequences</span></span>
<span><span class="va">train_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">indices</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="va">num_sequences</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">val_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">indices</span>, <span class="va">train_indices</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">sequence.matrix</span><span class="op">[</span><span class="va">train_indices</span>,<span class="op">]</span></span>
<span><span class="va">x_val</span> <span class="op">&lt;-</span> <span class="va">sequence.matrix</span><span class="op">[</span><span class="va">val_indices</span>,<span class="op">]</span></span>
<span>   </span>
<span><span class="co"># Parameters</span></span>
<span><span class="va">input_shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x_train</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fl">128</span></span>
<span><span class="va">encoding_dim</span> <span class="op">&lt;-</span> <span class="fl">40</span> </span>
<span><span class="va">hidden_dim1</span> <span class="op">&lt;-</span> <span class="fl">256</span> <span class="co"># Hidden layer 1 size</span></span>
<span><span class="va">hidden_dim2</span> <span class="op">&lt;-</span> <span class="fl">128</span>  <span class="co"># Hidden layer 2 size</span></span>
<span>    </span>
<span><span class="va">es</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/callback_early_stopping.html" class="external-link">callback_early_stopping</a></span><span class="op">(</span>monitor <span class="op">=</span> <span class="st">"val_loss"</span>,</span>
<span>                              min_delta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                              patience <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                              verbose <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              mode <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span></span>
<span>                    </span>
<span><span class="co"># Define the Model</span></span>
<span><span class="va">input_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_input.html" class="external-link">layer_input</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_shape</span><span class="op">)</span><span class="op">)</span></span>
<span>        </span>
<span><span class="co"># Encoder Layers</span></span>
<span><span class="va">encoded</span> <span class="op">&lt;-</span> <span class="va">input_seq</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">hidden_dim1</span>, name <span class="op">=</span> <span class="st">"e.1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_batch_normalization.html" class="external-link">layer_batch_normalization</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"bn.1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_activation.html" class="external-link">layer_activation</a></span><span class="op">(</span><span class="st">'leaky_relu'</span>, name <span class="op">=</span> <span class="st">"act.1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">hidden_dim2</span>, name <span class="op">=</span> <span class="st">"e.2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_batch_normalization.html" class="external-link">layer_batch_normalization</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"bn.2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_activation.html" class="external-link">layer_activation</a></span><span class="op">(</span><span class="st">'leaky_relu'</span>, name <span class="op">=</span> <span class="st">"act.2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">encoding_dim</span>, activation <span class="op">=</span> <span class="st">'selu'</span>, name <span class="op">=</span> <span class="st">"latent"</span><span class="op">)</span></span>
<span>                </span>
<span><span class="co"># Decoder Layers</span></span>
<span><span class="va">decoded</span> <span class="op">&lt;-</span> <span class="va">encoded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">hidden_dim2</span>, name <span class="op">=</span> <span class="st">"d.2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_batch_normalization.html" class="external-link">layer_batch_normalization</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"bn.3"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_activation.html" class="external-link">layer_activation</a></span><span class="op">(</span><span class="st">'leaky_relu'</span>, name <span class="op">=</span> <span class="st">"act.3"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">hidden_dim1</span>, name <span class="op">=</span> <span class="st">"d.1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_batch_normalization.html" class="external-link">layer_batch_normalization</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"bn.4"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_activation.html" class="external-link">layer_activation</a></span><span class="op">(</span><span class="st">'leaky_relu'</span>, name <span class="op">=</span> <span class="st">"act.4"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="va">input_shape</span>, activation <span class="op">=</span> <span class="st">'sigmoid'</span><span class="op">)</span></span>
<span>      </span>
<span><span class="co"># Autoencoder Model</span></span>
<span><span class="va">autoencoder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></span><span class="op">(</span><span class="va">input_seq</span>, <span class="va">decoded</span><span class="op">)</span></span>
<span><span class="va">autoencoder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/optimizer_adam.html" class="external-link">optimizer_adam</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span>,</span>
<span>                                   loss <span class="op">=</span> <span class="st">"mse"</span><span class="op">)</span></span>
<span>      </span>
<span><span class="co"># Train the model</span></span>
<span><span class="va">history</span> <span class="op">&lt;-</span> <span class="va">autoencoder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_train</span>,</span>
<span>                               y <span class="op">=</span> <span class="va">x_train</span>,</span>
<span>                               validation_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x_val</span>, <span class="va">x_val</span><span class="op">)</span>,</span>
<span>                               epochs <span class="op">=</span> <span class="va">epochs</span>,</span>
<span>                               batch_size <span class="op">=</span> <span class="va">batch_size</span>,</span>
<span>                               shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               callbacks <span class="op">=</span> <span class="va">es</span>, </span>
<span>                               verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, discrete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="immApex_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="classifier">Classifier<a class="anchor" aria-label="anchor" href="#classifier"></a>
</h3>
<p>We can also build classifiers directly using deep or shallow neural
networks. Building deep classifiers requires more data than classical
machine learning methods, like random forests, so the vignette may not
be ideal.</p>
<p>The first step is to generate distinct types of sequences using
<code><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences()</a></code> and <code><a href="https://rdrr.io/pkg/immApex/man/onehotEncoder.html" class="external-link">onehotEncoder()</a></code> to
prepare the data for the model.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class1.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences</a></span><span class="op">(</span>prefix.motif <span class="op">=</span> <span class="st">"CAS"</span>,</span>
<span>                                      suffix.motif <span class="op">=</span> <span class="st">"YF"</span>,</span>
<span>                                      number.of.sequences <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                                      min.length <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                      max.length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="va">class2.sequences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences</a></span><span class="op">(</span>prefix.motif <span class="op">=</span> <span class="st">"CASF"</span>,</span>
<span>                                      suffix.motif <span class="op">=</span> <span class="st">"YF"</span>,</span>
<span>                                      number.of.sequences <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                                      min.length <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                      max.length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">classifier.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/immApex/man/onehotEncoder.html" class="external-link">onehotEncoder</a></span><span class="op">(</span>input.sequences <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">class1.sequences</span>, <span class="va">class2.sequences</span><span class="op">)</span>, </span>
<span>                                   convert.to.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we will define and train the Keras classifier model using
artificial sequences. We will use a simple convolutional neural network
with 2 layers and then a single neuron that will classify the sequences
into class 1 or class 2 (here, the labels are 0 and 1).</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Input shape will be 1D as we are using a matrix</span></span>
<span><span class="va">input.shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">classifier.matrix</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#Simple model structure</span></span>
<span><span class="va">classifier.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">128</span>, activation <span class="op">=</span> <span class="st">"relu"</span>, </span>
<span>                                    input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input.shape</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">32</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                        <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">1</span>, activation <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">classifier.model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>        optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/optimizer_adam.html" class="external-link">optimizer_adam</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fl">0.00001</span><span class="op">)</span>,</span>
<span>        loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span>        metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"accuracy"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Separating data and labels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">val_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">classifier.matrix</span><span class="op">)</span>, <span class="fl">10000</span><span class="op">*</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">x_val</span> <span class="op">&lt;-</span> <span class="va">classifier.matrix</span><span class="op">[</span><span class="va">val_indices</span>,<span class="op">]</span></span>
<span><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">classifier.matrix</span><span class="op">[</span><span class="op">-</span><span class="va">val_indices</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">val_labels</span> <span class="op">&lt;-</span> <span class="va">labels</span><span class="op">[</span><span class="va">val_indices</span><span class="op">]</span></span>
<span><span class="va">train_labels</span> <span class="op">&lt;-</span> <span class="va">labels</span><span class="op">[</span><span class="op">-</span><span class="va">val_indices</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#Training the classifier.model</span></span>
<span><span class="va">history</span> <span class="op">&lt;-</span> <span class="va">classifier.model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">x_train</span>, </span>
<span>                                    <span class="va">train_labels</span>, </span>
<span>                                    epochs <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                                    batch_size <span class="op">=</span> <span class="fl">32</span>, </span>
<span>                                    validation_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x_val</span>, <span class="va">val_labels</span><span class="op">)</span>,</span>
<span>                                    verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, discrete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="immApex_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Here, we can achieve a validation accuracy of 98.25%, which is
impressive. But to contextualize, we used
<code><a href="https://rdrr.io/pkg/immApex/man/generateSequences.html" class="external-link">generateSequences()</a></code> and distinct motifs - “CAS” vs “CASF”
to create our 2 classes of sequences. Using sequences from experimental
data will likely result in lower accuracy or require greater model
complexity.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This has been a general overview of the capabilities of
<strong>immApex</strong> for processing immune receptor sequences and
making deep learning models. If you have any questions, comments, or
suggestions, feel free to visit the <a href="https://github.com/BorchLab/immApex" class="external-link">GitHub repository</a>.</p>
<div class="section level3">
<h3 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">## Running under: macOS Sonoma 14.6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/Chicago</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] dplyr_1.1.4       viridis_0.6.5     viridisLite_0.4.2 ggplot2_3.5.1    </span></span>
<span><span class="co">## [5] keras_2.15.0      immApex_1.0.3    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tidyselect_1.2.1            farver_2.1.2               </span></span>
<span><span class="co">##  [3] tensorflow_2.16.0           fastmap_1.2.0              </span></span>
<span><span class="co">##  [5] SingleCellExperiment_1.26.0 promises_1.3.2             </span></span>
<span><span class="co">##  [7] digest_0.6.37               lifecycle_1.0.4            </span></span>
<span><span class="co">##  [9] processx_3.8.6              magrittr_2.0.3             </span></span>
<span><span class="co">## [11] compiler_4.4.1              rlang_1.1.5                </span></span>
<span><span class="co">## [13] sass_0.4.9                  tools_4.4.1                </span></span>
<span><span class="co">## [15] yaml_2.3.10                 knitr_1.49                 </span></span>
<span><span class="co">## [17] labeling_0.4.3              S4Arrays_1.4.1             </span></span>
<span><span class="co">## [19] htmlwidgets_1.6.4           curl_6.2.1                 </span></span>
<span><span class="co">## [21] here_1.0.1                  reticulate_1.41.0.1        </span></span>
<span><span class="co">## [23] DelayedArray_0.30.1         xml2_1.3.7                 </span></span>
<span><span class="co">## [25] abind_1.4-8                 websocket_1.4.2            </span></span>
<span><span class="co">## [27] withr_3.0.2                 BiocGenerics_0.50.0        </span></span>
<span><span class="co">## [29] desc_1.4.3                  grid_4.4.1                 </span></span>
<span><span class="co">## [31] hash_2.2.6.3                stats4_4.4.1               </span></span>
<span><span class="co">## [33] colorspace_2.1-1            scales_1.3.0               </span></span>
<span><span class="co">## [35] zeallot_0.1.0               SummarizedExperiment_1.34.0</span></span>
<span><span class="co">## [37] cli_3.6.4                   rmarkdown_2.29             </span></span>
<span><span class="co">## [39] crayon_1.5.3                ragg_1.3.3                 </span></span>
<span><span class="co">## [41] generics_0.1.3              rstudioapi_0.17.1          </span></span>
<span><span class="co">## [43] httr_1.4.7                  tfruns_1.5.3               </span></span>
<span><span class="co">## [45] cachem_1.1.0                chromote_0.4.0             </span></span>
<span><span class="co">## [47] stringr_1.5.1               splines_4.4.1              </span></span>
<span><span class="co">## [49] zlibbioc_1.50.0             rvest_1.0.4                </span></span>
<span><span class="co">## [51] selectr_0.4-2               formatR_1.14               </span></span>
<span><span class="co">## [53] XVector_0.44.0              matrixStats_1.5.0          </span></span>
<span><span class="co">## [55] base64enc_0.1-3             keras3_1.3.0               </span></span>
<span><span class="co">## [57] vctrs_0.6.5                 Matrix_1.7-3               </span></span>
<span><span class="co">## [59] jsonlite_1.9.1              IRanges_2.38.1             </span></span>
<span><span class="co">## [61] S4Vectors_0.42.1            systemfonts_1.2.1          </span></span>
<span><span class="co">## [63] jquerylib_0.1.4             glue_1.8.0                 </span></span>
<span><span class="co">## [65] pkgdown_2.1.1               codetools_0.2-20           </span></span>
<span><span class="co">## [67] ps_1.9.0                    stringi_1.8.4              </span></span>
<span><span class="co">## [69] gtable_0.3.6                later_1.4.1                </span></span>
<span><span class="co">## [71] GenomeInfoDb_1.40.1         GenomicRanges_1.56.2       </span></span>
<span><span class="co">## [73] UCSC.utils_1.0.0            munsell_0.5.1              </span></span>
<span><span class="co">## [75] tibble_3.2.1                pillar_1.10.1              </span></span>
<span><span class="co">## [77] htmltools_0.5.8.1           GenomeInfoDbData_1.2.12    </span></span>
<span><span class="co">## [79] R6_2.6.1                    textshaping_1.0.0          </span></span>
<span><span class="co">## [81] rprojroot_2.0.4             evaluate_1.0.3             </span></span>
<span><span class="co">## [83] lattice_0.22-6              Biobase_2.64.0             </span></span>
<span><span class="co">## [85] png_0.1-8                   bslib_0.9.0                </span></span>
<span><span class="co">## [87] Rcpp_1.0.14                 nlme_3.1-167               </span></span>
<span><span class="co">## [89] gridExtra_2.3               dotty_0.1.0                </span></span>
<span><span class="co">## [91] SparseArray_1.4.8           mgcv_1.9-1                 </span></span>
<span><span class="co">## [93] whisker_0.4.1               xfun_0.51                  </span></span>
<span><span class="co">## [95] fs_1.6.5                    MatrixGenerics_1.16.0      </span></span>
<span><span class="co">## [97] pkgconfig_2.0.3</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nick Borcherding, Qile Yang, Ksenia Safina.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
